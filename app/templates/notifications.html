{% extends "base.html" %} {% block content %}
<h1>{{ _('Notifications') }}</h1>

{% if notifications %}
<div class="list-group">
  {% for notification in notifications %}
  <div class="list-group-item {% if not notification.read %}list-group-item-light{% endif %}">
    <div class="d-flex justify-content-between align-items-start">
      <div class="d-flex">
        {% if notification.actor %}
        <img src="{{ notification.actor.avatar(40) }}" alt="{{ notification.actor.username }}" class="rounded-circle me-3" style="width: 40px; height: 40px;">
        {% endif %}
        <div>
          {% if notification.name == 'new_follower' %}
          <p class="mb-1">
            <a href="{{ url_for('user', username=notification.get_data().username) }}">
              <strong>{{ notification.get_data().username }}</strong>
            </a>
            {{ _('started following you') }}
          </p>
          {% elif notification.name == 'post_liked' %}
          <p class="mb-1">
            <a href="{{ url_for('user', username=notification.get_data().username) }}">
              <strong>{{ notification.get_data().username }}</strong>
            </a>
            {{ _('liked your post') }}
          </p>
          {% elif notification.name == 'new_comment' %}
          <p class="mb-1">
            <a href="{{ url_for('user', username=notification.get_data().username) }}">
              <strong>{{ notification.get_data().username }}</strong>
            </a>
            {{ _('commented on your post') }}
          </p>
          {% else %}
          <p class="mb-1">{{ notification.name }}</p>
          {% endif %}
          <small class="text-muted post-time" data-timestamp="{{ notification.timestamp.isoformat() }}">
            {{ notification.timestamp.strftime('%Y-%m-%d %H:%M') }}
          </small>
        </div>
      </div>
      {% if not notification.read %}
      <button class="btn btn-sm btn-outline-primary mark-read" data-notification-id="{{ notification.id }}">
        {{ _('Mark Read') }}
      </button>
      {% endif %}
    </div>
  </div>
  {% endfor %}
</div>

<nav aria-label="Page navigation" class="mt-4">
  <ul class="pagination justify-content-center">
    {% if prev_url %}
    <li class="page-item">
      <a class="page-link" href="{{ prev_url }}">{{ _('Previous') }}</a>
    </li>
    {% endif %}
    {% if next_url %}
    <li class="page-item">
      <a class="page-link" href="{{ next_url }}">{{ _('Next') }}</a>
    </li>
    {% endif %}
  </ul>
</nav>

<script nonce="{{ nonce }}">
document.querySelectorAll('.mark-read').forEach(button => {
  button.addEventListener('click', function() {
    const notificationId = this.dataset.notificationId;
    fetch(`/notifications/mark_read/${notificationId}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      }
    }).then(response => {
      if (response.ok) {
        this.closest('.list-group-item').classList.remove('list-group-item-light');
        this.remove();
      }
    });
  });
});
</script>
{% else %}
<p class="text-muted">{{ _('No notifications yet.') }}</p>
{% endif %}

{% endblock %}
